<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FJBAA 15-Circuit Population Cartogram</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Instrument+Serif:ital@0;1&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0a0a0c;
  color: #e8e4df;
  font-family: 'JetBrains Mono', monospace;
  min-height: 100vh;
  overflow-x: hidden;
}

.page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 24px 60px;
}

header {
  margin-bottom: 48px;
  border-bottom: 1px solid #2a2a2e;
  padding-bottom: 32px;
}

header h1 {
  font-family: 'Instrument Serif', serif;
  font-size: 2.2rem;
  font-weight: 400;
  letter-spacing: -0.5px;
  color: #f0ece6;
  margin-bottom: 8px;
}

header .subtitle {
  font-size: 0.72rem;
  color: #6a6a70;
  text-transform: uppercase;
  letter-spacing: 2.5px;
  margin-bottom: 6px;
}

header .ref {
  font-size: 0.68rem;
  color: #4a4a50;
  letter-spacing: 1px;
}

.score-bar {
  display: flex;
  align-items: center;
  gap: 16px;
  margin: 28px 0 20px;
  padding: 16px 20px;
  background: #111114;
  border: 1px solid #1e1e22;
  border-radius: 3px;
}

.score-bar .metric {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.score-bar .metric .val {
  font-size: 1.5rem;
  font-weight: 700;
  color: #c8f06a;
}

.score-bar .metric .label {
  font-size: 0.58rem;
  color: #6a6a70;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.score-bar .sep {
  width: 1px;
  height: 36px;
  background: #2a2a2e;
}

.map-section {
  margin: 32px 0;
}

.map-title {
  font-size: 0.65rem;
  color: #6a6a70;
  text-transform: uppercase;
  letter-spacing: 2.5px;
  margin-bottom: 16px;
}

.cartogram-container {
  position: relative;
  background: #0e0e11;
  border: 1px solid #1a1a1e;
  border-radius: 3px;
  padding: 20px;
  overflow: hidden;
}

.cartogram-container::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background:
    repeating-linear-gradient(0deg, transparent, transparent 19px, #1a1a1e 19px, #1a1a1e 20px),
    repeating-linear-gradient(90deg, transparent, transparent 19px, #1a1a1e 19px, #1a1a1e 20px);
  opacity: 0.3;
  pointer-events: none;
}

canvas {
  display: block;
  margin: 0 auto;
  image-rendering: pixelated;
  position: relative;
  z-index: 1;
}

.legend-section {
  margin-top: 32px;
}

.legend-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 6px;
  margin-top: 12px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: #111114;
  border: 1px solid #1a1a1e;
  border-radius: 2px;
  transition: border-color 0.2s;
  cursor: default;
}

.legend-item:hover {
  border-color: #3a3a3e;
}

.legend-item .swatch {
  width: 14px;
  height: 14px;
  border-radius: 2px;
  flex-shrink: 0;
}

.legend-item .info {
  display: flex;
  flex-direction: column;
  gap: 1px;
  min-width: 0;
}

.legend-item .cname {
  font-size: 0.65rem;
  font-weight: 500;
  color: #d0ccc6;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.legend-item .cpop {
  font-size: 0.58rem;
  color: #6a6a70;
}

.legend-item .cdev {
  font-size: 0.55rem;
  font-weight: 500;
}

.legend-item .cdev.in { color: #8ab858; }
.legend-item .cdev.out { color: #d4644a; }

.note {
  margin-top: 36px;
  padding: 16px 20px;
  background: #111114;
  border-left: 2px solid #3a3a3e;
  font-size: 0.68rem;
  color: #7a7a80;
  line-height: 1.7;
}

.note strong {
  color: #a0a0a6;
  font-weight: 500;
}

.footer {
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid #1a1a1e;
  font-size: 0.6rem;
  color: #3a3a40;
  letter-spacing: 1px;
}

.tab-bar {
  display: flex;
  gap: 2px;
  margin-bottom: 20px;
}

.tab {
  padding: 8px 16px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  color: #6a6a70;
  background: #111114;
  border: 1px solid #1a1a1e;
  border-radius: 2px;
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.tab:hover { border-color: #3a3a3e; color: #a0a0a6; }
.tab.active { background: #1a1a1e; color: #c8f06a; border-color: #2a2a2e; }
</style>
</head>
<body>
<div class="page">
  <header>
    <div class="subtitle">Federal Judicial Balance and Accountability Act</div>
    <h1>15-Circuit Population Cartogram</h1>
    <div class="ref">Config M &middot; District-Level Model &middot; 2020 Census</div>
  </header>

  <div class="score-bar">
    <div class="metric">
      <span class="val">14/15</span>
      <span class="label">In Band</span>
    </div>
    <div class="sep"></div>
    <div class="metric">
      <span class="val">5.7%</span>
      <span class="label">Mean |Dev|</span>
    </div>
    <div class="sep"></div>
    <div class="metric">
      <span class="val">1.40:1</span>
      <span class="label">Pop Ratio</span>
    </div>
    <div class="sep"></div>
    <div class="metric">
      <span class="val">14/15</span>
      <span class="label">Contiguous</span>
    </div>
  </div>

  <div class="map-section">
    <div class="map-title">Population Cartogram &middot; Each square = ~660,000 people</div>
    <div class="tab-bar">
      <button class="tab active" onclick="setView('cartogram')">Cartogram</button>
      <button class="tab" onclick="setView('geo')">Geographic</button>
    </div>
    <div class="cartogram-container">
      <canvas id="mapCanvas" width="960" height="560"></canvas>
    </div>
  </div>

  <div class="legend-section">
    <div class="map-title">Circuit Detail</div>
    <div class="legend-grid" id="legendGrid"></div>
  </div>

  <div class="note">
    <strong>Reading this map:</strong> This is a population cartogram, not a geographic map.
    Each colored square represents approximately 660,000 people. Circuits that serve equal
    populations appear as roughly equal-sized colored blocks -- which is the point.
    A traditional geographic map would visually exaggerate the Mountain-Southwest circuit
    (which covers ~590,000 square miles) relative to Metro New York (which covers ~2,500
    square miles), even though they serve nearly identical populations. The cartogram shows
    what the Act cares about: people, not acres.
    <br><br>
    <strong>Split states:</strong> CA, TX, NY, PA, IL, IN, KY, TN, AL, GA, NC, VA, WV, MS, OH
    are divided between circuits at existing federal judicial district boundaries.
  </div>

  <div class="footer">
    AMERICAN POLICY ARCHITECTURE INSTITUTE &middot; BASED ON REV 2.1 OF THE FJBAA &middot; FEBRUARY 2026
  </div>
</div>

<script>
const circuits = [
  { num: "1st",  name: "Southern California",     pop: 22538280, dev: 2.0,   inBand: true,  color: "#e07850" },
  { num: "2nd",  name: "N. California-Nevada",    pop: 20104557, dev: -9.0,  inBand: true,  color: "#d4a054" },
  { num: "3rd",  name: "NW-Northern Plains",      pop: 21168258, dev: -4.2,  inBand: true,  color: "#6baa5e" },
  { num: "4th",  name: "Mountain-Southwest",      pop: 21252234, dev: -3.8,  inBand: true,  color: "#c4a840" },
  { num: "5th",  name: "Gulf States",             pop: 23766829, dev: 7.6,   inBand: true,  color: "#c46478" },
  { num: "6th",  name: "South Central",           pop: 21834357, dev: -1.2,  inBand: true,  color: "#d48c5c" },
  { num: "7th",  name: "Upper Mississippi",        pop: 20945494, dev: -5.2,  inBand: true,  color: "#5c9cb4" },
  { num: "8th",  name: "Great Lakes",             pop: 21836435, dev: -1.2,  inBand: true,  color: "#4488b0" },
  { num: "9th",  name: "Ohio Valley",             pop: 22071048, dev: -0.1,  inBand: true,  color: "#6878a8" },
  { num: "10th", name: "Appalachian",             pop: 20400988, dev: -7.6,  inBand: true,  color: "#8c7ca0" },
  { num: "11th", name: "Southeast",               pop: 20508021, dev: -7.2,  inBand: true,  color: "#a06880" },
  { num: "12th", name: "Florida",                 pop: 21538187, dev: -2.5,  inBand: true,  color: "#48a890" },
  { num: "13th", name: "Chesapeake",              pop: 21828678, dev: -1.2,  inBand: true,  color: "#7090a8" },
  { num: "14th", name: "Metro New York",          pop: 23440591, dev: 6.1,   inBand: true,  color: "#5870c0" },
  { num: "15th", name: "New England-Keystone",    pop: 28124936, dev: 27.3,  inBand: false, color: "#9060a8" },
];

// State positions in a hex-grid cartogram layout
// Row-based, each state placed approximately where it belongs geographically
// but sized by rough population weight (number of cells)
// Format: [stateAbbr, circuitIndex (0-14), row, col, cells]

// We'll use a simplified grid: each cell ~660K people
// Total pop ~331M / 660K = ~502 cells across a ~35x20 grid

const CELL = 660000;
const COLS = 48;
const ROWS = 28;

// Build the grid by painting regions
// Each entry: [circuit_index, startRow, startCol, width, height]
// We'll paint block by block, roughly geographic

function buildGrid() {
  const grid = Array.from({length: ROWS}, () => Array(COLS).fill(-1));

  // Helper: fill a rectangular region
  function fill(ci, r, c, w, h) {
    for (let dr = 0; dr < h; dr++)
      for (let dc = 0; dc < w; dc++)
        if (r+dr < ROWS && c+dc < COLS) grid[r+dr][c+dc] = ci;
  }

  // Helper: fill specific cells
  function cells(ci, coords) {
    coords.forEach(([r,c]) => { if (r < ROWS && c < COLS) grid[r][c] = ci; });
  }

  // === GEOGRAPHIC APPROXIMATION VIEW ===
  // Pacific Northwest + N Plains (3rd) - top-left, stretching right
  // AK, HI, WA, OR, ID, MT, WY, ND, SD, NE = 21.2M = ~32 cells
  fill(2, 0, 0, 4, 2);   // AK
  fill(2, 7, 0, 2, 2);   // HI
  fill(2, 1, 4, 3, 3);   // WA
  fill(2, 4, 4, 3, 3);   // OR
  fill(2, 1, 7, 2, 3);   // ID
  fill(2, 0, 9, 3, 2);   // MT
  fill(2, 2, 9, 2, 2);   // WY
  fill(2, 0, 12, 2, 1);  // ND
  fill(2, 1, 12, 2, 1);  // SD
  fill(2, 2, 12, 3, 1);  // NE

  // N California-Nevada (2nd) - 20.1M = ~30 cells
  // CA-N, CA-E, NV
  fill(1, 4, 2, 2, 4);   // NV
  fill(1, 4, 0, 2, 2);   // CA-N
  fill(1, 6, 0, 2, 3);   // CA-E

  // Southern California (1st) - 22.5M = ~34 cells
  // CA-C, CA-S
  fill(0, 9, 0, 3, 4);   // CA-C (big)
  fill(0, 8, 0, 2, 1);   // CA-C cont
  fill(0, 13, 0, 2, 2);  // CA-S

  // Mountain-Southwest (4th) - 21.3M = ~32 cells
  // AZ, CO, UT, NM, KS
  fill(3, 4, 9, 2, 2);   // UT
  fill(3, 4, 7, 2, 2);   // CO part
  fill(3, 6, 4, 2, 3);   // AZ (big)
  fill(3, 9, 4, 2, 2);   // AZ cont
  fill(3, 7, 6, 2, 3);   // NM
  fill(3, 3, 12, 2, 2);  // KS
  fill(3, 6, 7, 1, 2);   // CO cont

  // Gulf States (5th) - 23.8M = ~36 cells
  // TX-S, TX-W, LA, MS
  fill(4, 11, 4, 3, 3);  // TX-W
  fill(4, 14, 4, 3, 3);  // TX-S
  fill(4, 10, 7, 2, 4);  // LA
  fill(4, 14, 7, 2, 2);  // MS

  // South Central (6th) - 21.8M = ~33 cells
  // TX-N, TX-E, OK, AR, TN-W
  fill(5, 7, 9, 3, 3);   // OK
  fill(5, 10, 9, 3, 2);  // AR
  fill(5, 7, 12, 1, 2);  // TN-W
  fill(5, 12, 9, 2, 2);  // TX-N
  fill(5, 14, 9, 2, 2);  // TX-E

  // Upper Mississippi (7th) - 20.9M = ~32 cells
  // MN, WI, IA, MO
  fill(6, 0, 14, 3, 3);  // MN
  fill(6, 0, 17, 3, 2);  // WI
  fill(6, 3, 14, 2, 2);  // IA
  fill(6, 5, 12, 3, 2);  // MO
  fill(6, 2, 17, 1, 1);  // WI cont

  // Great Lakes (8th) - 21.8M = ~33 cells
  // MI, IN-N, IL-N
  fill(7, 0, 20, 4, 3);  // MI
  fill(7, 3, 20, 1, 2);  // IN-N
  fill(7, 3, 16, 2, 2);  // IL-N
  fill(7, 3, 18, 2, 2);  // MI cont

  // Ohio Valley (9th) - 22.1M = ~33 cells
  // OH, IN-S, IL-C, IL-S, KY-W
  fill(8, 5, 14, 2, 2);  // IL-C, IL-S
  fill(8, 5, 16, 2, 2);  // IN-S
  fill(8, 5, 18, 2, 2);  // KY-W + part
  fill(8, 3, 22, 3, 3);  // OH
  fill(8, 5, 21, 1, 2);  // OH cont

  // Appalachian (10th) - 20.4M = ~31 cells
  // TN-E, TN-M, KY-E, VA-W, AL, NC-W, GA-S
  fill(9, 7, 14, 3, 2);  // TN-E, TN-M
  fill(9, 7, 17, 2, 1);  // KY-E
  fill(9, 8, 17, 1, 2);  // VA-W
  fill(9, 9, 12, 2, 3);  // AL
  fill(9, 9, 14, 1, 2);  // NC-W / GA-S overlap
  fill(9, 10, 14, 1, 2);

  // Southeast (11th) - 20.5M = ~31 cells
  // GA-N, GA-M, SC, NC-E, NC-M
  fill(10, 8, 19, 3, 2);  // NC
  fill(10, 10, 17, 3, 2); // GA-N, GA-M
  fill(10, 10, 20, 2, 2); // SC
  fill(10, 12, 17, 1, 1); // GA cont

  // Florida (12th) - 21.5M = ~33 cells
  fill(11, 12, 18, 2, 2); // FL-N
  fill(11, 14, 18, 2, 2); // FL-M
  fill(11, 16, 19, 2, 3); // FL-S
  fill(11, 14, 20, 1, 2); // FL cont
  fill(11, 16, 18, 1, 2);

  // Chesapeake (13th) - 21.8M = ~33 cells
  // VA-E, WV, MD, DC, DE, PA-E
  fill(12, 6, 22, 3, 2);  // VA-E + WV
  fill(12, 6, 20, 2, 2);  // WV
  fill(12, 4, 25, 3, 2);  // MD, DC, DE
  fill(12, 8, 22, 2, 1);  // VA-E cont
  fill(12, 6, 25, 2, 1);  // PA-E

  // Metro New York (14th) - 23.4M = ~35 cells
  // NY-E, NY-S, NJ
  fill(13, 0, 28, 3, 3);  // NY-E, NY-S
  fill(13, 3, 27, 2, 2);  // NJ
  fill(13, 0, 26, 2, 2);  // NY cont
  fill(13, 2, 26, 1, 1);

  // New England-Keystone (15th) - 28.1M = ~43 cells
  // NY-N, NY-W, PA-M, PA-W, CT, MA, RI, NH, VT, ME
  fill(14, 0, 31, 4, 2);  // ME, NH, VT
  fill(14, 2, 28, 3, 2);  // MA, CT, RI
  fill(14, 2, 31, 3, 2);  // NY-N, NY-W
  fill(14, 4, 27, 2, 2);  // PA-M
  fill(14, 5, 25, 2, 2);  // PA-W
  fill(14, 4, 29, 2, 2);  // upstate cont

  return grid;
}

function buildCartogramGrid() {
  // Population cartogram: each circuit gets cells proportional to population
  // Arranged in rough geographic position but sized by pop
  const grid = Array.from({length: ROWS}, () => Array(COLS).fill(-1));

  function fill(ci, r, c, w, h) {
    for (let dr = 0; dr < h; dr++)
      for (let dc = 0; dc < w; dc++)
        if (r+dr < ROWS && c+dc < COLS) grid[r+dr][c+dc] = ci;
  }

  // Each circuit gets ~area proportional to population
  // Smallest: ~20M = ~30 cells, Largest: ~28M = ~43 cells
  // Target: ~33 cells each (22M/660K)

  // Row 0-5: Northern tier (NW Plains, Upper Miss, Great Lakes, NE, Metro NY)
  // Row 6-12: Middle tier (CA, Mtn, S Central, OV, App, SE, Chesapeake)
  // Row 13-19: Southern tier (S CA, Gulf, FL)

  // 3rd NW-N Plains (32 cells) - top left
  fill(2, 0, 0, 8, 4);    // 32

  // 7th Upper Mississippi (32 cells)
  fill(6, 0, 8, 8, 4);    // 32

  // 8th Great Lakes (33 cells)
  fill(7, 0, 16, 6, 4);   // 24
  fill(7, 4, 16, 3, 3);   // +9 = 33

  // 15th NE-Keystone (43 cells) -- the outlier, biggest block
  fill(14, 0, 22, 7, 4);  // 28
  fill(14, 4, 25, 4, 4);  // +16 = 44 (close enough)

  // 14th Metro New York (35 cells)
  fill(14, 0, 29, 4, 3);  // steal some from NE area...
  // Actually let me redo the top row more carefully

  // RESET and do properly
  for (let r = 0; r < ROWS; r++) grid[r].fill(-1);

  // Layout: roughly 6 columns of circuits, 3 rows deep
  // Row A (0-8): West | Midwest | East
  // Row B (9-17): CA | TX-region | South | Mid-Atlantic
  // Row C (18-25): leftovers

  // Simpler: just tile them in rough geographic order
  // Each circuit is a rectangle, placed left-to-right, top-to-bottom

  const layout = [
    // [circuitIdx, row, col, width, height]
    // TOP ROW: West to East
    [2,  0, 0, 8, 4],    // 3rd NW Plains (32)
    [6,  0, 8, 8, 4],    // 7th Upper Miss (32)
    [7,  0, 16, 8, 4],   // 8th Great Lakes (32 - slightly less but ok)
    [14, 0, 24, 8, 5],   // 15th NE-Keystone (40 - slightly less than 43)
    [13, 0, 32, 8, 4],   // 14th Metro NY (32 - slightly less but ok)

    // MIDDLE ROW
    [1,  4, 0, 5, 6],    // 2nd N CA-NV (30)
    [3,  4, 5, 6, 5],    // 4th Mountain-SW (30)
    [5,  4, 11, 6, 5],   // 6th South Central (30)
    [8,  4, 17, 7, 5],   // 9th Ohio Valley (35)
    [9,  5, 24, 6, 5],   // 10th Appalachian (30)
    [12, 5, 30, 6, 5],   // 13th Chesapeake (30)

    // BOTTOM ROW
    [0,  10, 0, 5, 7],   // 1st S California (35)
    [4,  9, 5, 7, 5],    // 5th Gulf States (35)
    [10, 10, 12, 6, 5],  // 11th Southeast (30)
    [11, 10, 18, 6, 5],  // 12th Florida (30)
    [10, 9, 18, 2, 1],   // SE cont
  ];

  layout.forEach(([ci, r, c, w, h]) => fill(ci, r, c, w, h));

  return grid;
}

let currentView = 'cartogram';

function setView(v) {
  currentView = v;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  draw();
}

function draw() {
  const canvas = document.getElementById('mapCanvas');
  const ctx = canvas.getContext('2d');
  const grid = currentView === 'cartogram' ? buildCartogramGrid() : buildGrid();

  const cellW = Math.floor(canvas.width / COLS);
  const cellH = Math.floor(canvas.height / ROWS);

  ctx.fillStyle = '#0e0e11';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Draw cells
  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      const ci = grid[r][c];
      if (ci >= 0) {
        const circuit = circuits[ci];
        ctx.fillStyle = circuit.color;
        ctx.fillRect(c * cellW, r * cellH, cellW - 1, cellH - 1);

        // Add subtle noise/texture
        ctx.fillStyle = `rgba(0,0,0,${Math.random() * 0.15})`;
        ctx.fillRect(c * cellW, r * cellH, cellW - 1, cellH - 1);
      }
    }
  }

  // Draw circuit labels
  const labelPositions = {};
  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      const ci = grid[r][c];
      if (ci >= 0) {
        if (!labelPositions[ci]) {
          labelPositions[ci] = { minR: r, maxR: r, minC: c, maxC: c, count: 0 };
        }
        const lp = labelPositions[ci];
        lp.minR = Math.min(lp.minR, r);
        lp.maxR = Math.max(lp.maxR, r);
        lp.minC = Math.min(lp.minC, c);
        lp.maxC = Math.max(lp.maxC, c);
        lp.count++;
      }
    }
  }

  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';

  Object.entries(labelPositions).forEach(([ci, lp]) => {
    const cx = ((lp.minC + lp.maxC + 1) / 2) * cellW;
    const cy = ((lp.minR + lp.maxR + 1) / 2) * cellH;
    const circuit = circuits[parseInt(ci)];

    // Circuit number
    ctx.font = `bold ${cellH * 1.1}px 'JetBrains Mono', monospace`;
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillText(circuit.num, cx + 1, cy - cellH * 0.4 + 1);
    ctx.fillStyle = '#fff';
    ctx.fillText(circuit.num, cx, cy - cellH * 0.4);

    // Population
    const popStr = (circuit.pop / 1e6).toFixed(1) + 'M';
    ctx.font = `300 ${cellH * 0.7}px 'JetBrains Mono', monospace`;
    ctx.fillStyle = 'rgba(255,255,255,0.6)';
    ctx.fillText(popStr, cx, cy + cellH * 0.5);
  });
}

// Build legend
const legendGrid = document.getElementById('legendGrid');
circuits.forEach(c => {
  const div = document.createElement('div');
  div.className = 'legend-item';
  const devStr = (c.dev >= 0 ? '+' : '') + c.dev.toFixed(1) + '%';
  div.innerHTML = `
    <div class="swatch" style="background:${c.color}"></div>
    <div class="info">
      <span class="cname">${c.num} ${c.name}</span>
      <span class="cpop">${(c.pop/1e6).toFixed(1)}M &middot; <span class="cdev ${c.inBand ? 'in' : 'out'}">${devStr}${c.inBand ? '' : ' OUT'}</span></span>
    </div>
  `;
  legendGrid.appendChild(div);
});

draw();
</script>
</body>
</html>
